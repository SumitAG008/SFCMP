<mvc:View controllerName="com.sap.sf.compensation.controller.WorkflowVisualization"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:form="sap.ui.layout.form"
    displayBlock="true"
    height="100%">
    <Page id="workflowPage" title="{workflow>/workflowName}" showNavButton="true" navButtonPress="onNavBack" class="sapUiNoContentPadding">
        <headerContent>
            <Button id="refreshWorkflowBtn" icon="sap-icon://refresh" press="onRefresh" tooltip="Refresh Workflow"/>
            <Button id="exportWorkflowBtn" icon="sap-icon://download" press="onExport" tooltip="Export Workflow"/>
        </headerContent>
        <content>
            <VBox class="sapUiSmallMargin">
                <!-- Workflow Header Information -->
                <Panel headerText="Workflow Information" class="sapUiNoContentPadding">
                    <form:SimpleForm layout="ResponsiveGridLayout">
                        <form:content>
                            <Label text="Company ID"/>
                            <Text text="{workflow>/companyId}"/>
                            <Label text="Form ID"/>
                            <Text text="{workflow>/formId}"/>
                            <Label text="Workflow Name"/>
                            <Text text="{workflow>/workflowName}" class="sapUiTextBold"/>
                            <Label text="Workflow Status"/>
                            <ObjectStatus text="{workflow>/overallStatus}" 
                                state="{workflow>/statusState}" 
                                icon="{workflow>/statusIcon}"/>
                            <Label text="Current Step"/>
                            <Text text="{workflow>/currentStep}"/>
                            <Label text="Initiated By"/>
                            <Text text="{workflow>/initiatedBy}"/>
                            <Label text="Initiated Date"/>
                            <Text text="{workflow>/initiatedDate}"/>
                        </form:content>
                    </form:SimpleForm>
                </Panel>

                <!-- Dynamic Workflow Process Flow - Vertical Visualization -->
                <Panel headerText="Approval Workflow Process" class="sapUiNoContentPadding">
                    <VBox class="sapUiMediumMargin" alignItems="Center">
                        <VBox id="workflowStepsContainer" class="workflow-container" width="100%">
                            <!-- Dynamic Workflow Steps - Generated from Real Data -->
                            <VBox items="{workflow>/steps}" class="workflow-steps-list">
                                <items>
                                    <!-- Workflow Step Card -->
                                    <VBox class="workflow-step-card sapUiMediumMarginBottom">
                                        <HBox class="workflow-step sapUiSmallMargin" alignItems="Start">
                                            <VBox class="workflow-step-content" width="100%">
                                                <!-- Step Header -->
                                                <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                                                    <core:Icon src="{workflow>icon}" 
                                                        size="2rem" 
                                                        class="sapUiTinyMarginEnd workflow-icon-{workflow>statusState}"
                                                        color="{= ${workflow>statusState} === 'Success' ? '#28a745' : (${workflow>statusState} === 'Warning' ? '#ffc107' : '#6c757d') }"/>
                                                    <VBox>
                                                        <Title text="Step {workflow>stepNumber}: {workflow>stepName}" level="H4"/>
                                                        <Text text="{workflow>description}" class="sapUiTinyMarginTop" visible="{= !!${workflow>description} }"/>
                                                    </VBox>
                                                    <ToolbarSpacer/>
                                                    <ObjectStatus text="{workflow>status}" 
                                                        state="{workflow>statusState}"
                                                        icon="{= ${workflow>statusState} === 'Success' ? 'sap-icon://accept' : (${workflow>statusState} === 'Warning' ? 'sap-icon://pending' : 'sap-icon://circle-task') }"/>
                                                </HBox>
                                                
                                                <!-- Assignee Information -->
                                                <HBox alignItems="Center" class="sapUiSmallMarginTop">
                                                    <f:Avatar src="{workflow>assigneePhoto}" 
                                                        displaySize="M" 
                                                        displayShape="Circle"
                                                        class="sapUiTinyMarginEnd"
                                                        visible="{= !!${workflow>assigneePhoto} }"/>
                                                    <VBox class="sapUiSmallMarginBegin">
                                                        <Text text="{workflow>assigneeName}" class="sapUiTextBold" visible="{= !!${workflow>assigneeName} }"/>
                                                        <Text text="{workflow>assigneeRole}" class="sapUiTinyMarginTop" visible="{= !!${workflow>assigneeRole} }"/>
                                                        <HBox class="sapUiTinyMarginTop" visible="{= !!${workflow>dueDays} }">
                                                            <Text text="Due: " class="sapUiTinyMarginEnd"/>
                                                            <Text text="{workflow>dueDays} days" class="sapUiTextBold"/>
                                                        </HBox>
                                                    </VBox>
                                                    <ToolbarSpacer/>
                                                    <VBox alignItems="End">
                                                        <Text text="Completed: {workflow>completedDate}" 
                                                            visible="{= !!${workflow>completedDate} }" 
                                                            class="sapUiTinyMarginTop"/>
                                                        <Text text="Due Date: {workflow>dueDate}" 
                                                            visible="{= !!${workflow>dueDate} }" 
                                                            class="sapUiTinyMarginTop"/>
                                                    </VBox>
                                                </HBox>
                                                
                                                <!-- Comments Section -->
                                                <TextArea value="{workflow>comments}" 
                                                    placeholder="No comments yet..." 
                                                    rows="2"
                                                    editable="false"
                                                    class="sapUiSmallMarginTop"
                                                    visible="{= !!${workflow>comments} || ${workflow>statusState} === 'Warning' }"/>
                                                
                                                <!-- Action Buttons (if step is in progress) -->
                                                <HBox class="sapUiSmallMarginTop" visible="{= ${workflow>statusState} === 'Warning' }">
                                                    <Button text="Approve" 
                                                        type="Emphasized" 
                                                        icon="sap-icon://accept" 
                                                        press="onApproveStep"
                                                        class="sapUiTinyMarginEnd"/>
                                                    <Button text="Reject" 
                                                        type="Reject" 
                                                        icon="sap-icon://decline" 
                                                        press="onRejectStep"
                                                        class="sapUiTinyMarginEnd"/>
                                                    <Button text="Add Comment" 
                                                        icon="sap-icon://comment" 
                                                        press="onAddComment"
                                                        type="Transparent"/>
                                                </HBox>
                                            </VBox>
                                        </HBox>
                                        
                                        <!-- Connector Arrow (show between steps, not after last) -->
                                        <HBox justifyContent="Center" class="workflow-connector" visible="{= ${workflow>stepNumber} !== ${workflow>/steps/length} }">
                                            <core:Icon src="sap-icon://arrow-down" 
                                                size="2rem" 
                                                color="{= ${workflow>statusState} === 'Success' ? '#28a745' : '#0070f2' }"/>
                                        </HBox>
                                    </VBox>
                                </items>
                            </VBox>
                            
                            <!-- Empty State -->
                            <VBox visible="{= !${workflow>/steps} || ${workflow>/steps/length} === 0 }" alignItems="Center" class="sapUiLargeMargin">
                                <core:Icon src="sap-icon://workflow-tasks" size="4rem" class="sapUiMediumMarginBottom"/>
                                <Title text="No Workflow Steps Configured" level="H3"/>
                                <Text text="Please configure workflow steps in the Workflow Builder" class="sapUiSmallMarginTop"/>
                                <Button text="Configure Workflow" icon="sap-icon://settings" press="onConfigureWorkflow" type="Emphasized" class="sapUiSmallMarginTop"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </Panel>

                <!-- Employee Compensation Summary -->
                <Panel headerText="Compensation Summary" expandable="true" expanded="false" class="sapUiSmallMarginTop">
                    <List items="{workflow>/employees}" visible="{= ${workflow>/employees/length} > 0 }">
                        <StandardListItem
                            title="{workflow>employeeName}"
                            description="{workflow>employeeId}"
                            icon="{workflow>photo}"
                            info="{workflow>finalSalary}"
                            infoState="Success"/>
                    </List>
                    <VBox visible="{= !${workflow>/employees} || ${workflow>/employees/length} === 0 }" alignItems="Center" class="sapUiMediumMargin">
                        <Text text="No employee data available"/>
                    </VBox>
                </Panel>
            </VBox>
        </content>
    </Page>
</mvc:View>
